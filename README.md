# YaMDb
### Описание
Проект **YaMDb** собирает отзывы пользователей на произведения. Произведения делятся на категории: «Книги», «Фильмы», «Музыка».
### API документация
<http://127.0.0.1:8000/redoc>
### Технологии
Python 3.7
Django 2.2.16
Django Rest Framework 3.12.4
Simple JWT
PostgreSQL 13.0
Gunicorn 20.0.4
NGINX 1.21.4
Docker compose 1.29.2
### Алгоритм регистрации пользователей
1. Пользователь отправляет запрос с параметром `email` на `/auth/email/`.
2. **YaMDB** отправляет письмо с кодом подтверждения (`confirmation_code`) на адрес  `email` .
3. Пользователь отправляет запрос с параметрами `email` и `confirmation_code` на `/auth/token/`, в ответе на запрос ему приходит `token` (JWT-токен).
4. При желании пользователь отправляет PATCH-запрос на `/users/me/` и заполняет поля в своём профайле (описание полей — в документации).
### Пользовательские роли
- **Аноним** — может просматривать описания произведений, читать отзывы и комментарии.
- **Аутентифицированный пользователь** — может, как и **Аноним**, читать всё, дополнительно он может публиковать отзывы и ставить рейтинг произведениям (фильмам/книгам/песенкам), может комментировать чужие отзывы и ставить им оценки; может редактировать и удалять **свои** отзывы и комментарии.
- **Модератор** — те же права, что и у **Аутентифицированного пользователя** плюс право удалять **любые** отзывы и комментарии.
- **Администратор** — полные права на управление проектом и всем его содержимым. Может создавать и удалять категории и произведения. Может назначать роли пользователям.
- **Администратор Django** — те же права, что и у роли **Администратор**.
### Шаблон наполнения env-файла
В папке `/infra_sp2/infra` создаем  `.env`-файл, в котором устанавливаем парамаетры подключения к базе данных PostgreSQL приложения.
- DB_ENGINE=django.db.backends.postgresql # указываем, что работаем с postgresql
- DB_NAME=postgres # имя базы данных
- POSTGRES_USER=postgres # логин для подключения к базе данных
- POSTGRES_PASSWORD=postgres # пароль для подключения к БД (установите свой)
- DB_HOST=db # название сервиса (контейнера)
- DB_PORT=5432 # порт для подключения к БД 
### Как запустить
1. Устанавливаем Docker:
  - [Установка Docker на **Linux**](https://docs.docker.com/engine/install/)
  - [Установка Docker **Mac/Windows**](https://docs.docker.com/desktop/)
2. Задаем параметры подключения к БД PostgreSQL в `.env`-файлe согласно шаблону выше.
3. Переходим в папку `/infra_sp2/infra` и выполняем команду создания контейнеров:
```
docker-compose up -d --build
```
4. Далее делаем миграции, создаем суперпользователя, собираем статику:
```
docker-compose exec web python manage.py migrate
docker-compose exec web python manage.py createsuperuser
docker-compose exec web python manage.py collectstatic --no-input
```
5. Проект доступен по адресу http://localhost/
### Заполение БД тестовыми данными
Для заполнени БД тестовыми данными необходимо выполнить:
1. Скопировать файл fixtures.json из `/infra_sp2/infra` в контейнер **web**
```
docker cp fixtures.json <имя контейнера>:/app/ # например, infra_web_1
```
> Note: `<имя контейнера>` можно узнать с помощью команды:
```
docker container ls
```
2. Выполнить загрузку данных в БД:
```
docker-compose exec web python manage.py loaddata fixtures.json
```
### Контакты
- [**Github**](https://github.com/Torolfr/)
- **email**: torolfr@yandex.ru
![workflow status](https://github.com/Torolfr/yamdb_final/.github/workflows/yamdb_workflow.yml/badge.svg)
***